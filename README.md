# KOS_COMPTA ‚Äî AI Agent with CI/CD in Accounting and Compliance

> **GitLab AI Hackathon 2026**  
> _The KOS is the legislator. The LLM is the executor. The CI/CD is the tribunal._

---

## What is KOS_COMPTA ?

KOS*COMPTA is a **Compliance ERP Middleware** ‚Äî an AI agent integrated into a GitLab CI/CD pipeline that intercepts accounting documents before they enter any ERP system, audits them against French law (\_r√©gularit√©, sinc√©rit√©, image fid√®le* ‚Äî Art. L123-14 Code de Commerce), and routes them accordingly.

**No illegal document enters the books.**

Built on top of a **Knowledge Operating System (KOS)** ‚Äî a local knowledge base of structured JSON root files and vectorized French accounting norms ‚Äî the system is fully LLM-agnostic. Swap the model, the compliance stays.

---

## Architecture

```
E0_MOTEUR_AGENTIQUE/       ‚Üê Brain ‚Äî agent code + constitutional JSON files
E1_CORPUS_LEGAL_ETAT/      ‚Üê French law ‚Äî PCG, TVA, CGI, ANC norms (read-only)
E2_SOP_INTERNE_ET_ERP/     ‚Üê Internal company rules + ERP config
E3_INTERFACES_ACTEURS/
  E3.1_Dropzone_Factures/  ‚Üê Incoming documents (invoices, expense reports)
  E3.2_Requetes_Assistants/ ‚Üê Free-form human queries (copilot mode)
E4_AUDIT_ET_ROUTAGE/
  E4.1_Rapports_Conformite/ ‚Üê REJECTED + WARNING reports (legal ref cited)
  E4.2_Payloads_ERP/        ‚Üê COMPLIANT payloads ready for ERP injection
  E4.3_Imports_ERP/         ‚Üê CSV files generated by export_erp.py (CEGID format)
```

---

## Pipeline ‚Äî How it works

```mermaid
flowchart TD
    A["Incoming Document<br/>invoice / expense report / journal entry"] --> B

    subgraph PIPELINE["GitLab CI/CD Pipeline"]
        B["Stage 1 - Detect<br/>Document type identified"]
        C["Stage 2 - Load KOS<br/>Applicable norms loaded<br/>E1 legal corpus + E2 internal SOP"]
        D["Stage 3 - Analyse<br/>Claude API<br/>regularity - sincerity - true and fair view"]
        E["Stage 4 - Report<br/>Automatic MR comment published"]
        B --> C --> D --> E
    end

    E --> O1["COMPLIANT<br/>ERP Payload generated"]
    E --> O2["WARNING<br/>Human review required"]
    E --> O3["REJECTED<br/>Legal article cited + corrections listed"]
```

---

## Quick Start

```bash
# 1. Clone the repo
git clone https://gitlab.com/[USERNAME]/kos-compta.git
cd kos-compta

# 2. Install dependencies
pip install anthropic chromadb python-frontmatter fastapi

# 3. Set your API key
export ANTHROPIC_API_KEY=sk-ant-...

# 4. Drop a document in E3.1
cp my_invoice.md E3_INTERFACES_ACTEURS/E3.1_Dropzone_Factures/

# 5. Run the agent
python E0_MOTEUR_AGENTIQUE/agent_compliance.py

# 6. Check the result
ls E4_AUDIT_ET_ROUTAGE/E4.1_Rapports_Conformite/
ls E4_AUDIT_ET_ROUTAGE/E4.2_Payloads_ERP/
```

---

## Tech Stack

Python ¬∑ YAML ¬∑ JSON ¬∑ SQL ¬∑ Markdown ¬∑ ChromaDB ¬∑ GraphDB ¬∑ GitLab CI/CD ¬∑ GitLab Duo ¬∑ Claude API (Anthropic) ¬∑ Ollama ¬∑ Gemini API ¬∑ FastAPI ¬∑ anthropic-sdk ¬∑ PCG ¬∑ CGI ¬∑ Code de Commerce ¬∑ BOFiP ¬∑ CSV ¬∑ Excel ¬∑ Sage ¬∑ EBP ¬∑ Cegid ¬∑ Pennylane ¬∑ VS Code ¬∑ Git ¬∑ KOS

---

## Project Status ‚Äî Hackathon MVP

> **Deadline : 25 mars 2026 ‚Äî 14h00 EDT**
> Suivi d√©taill√© dans `KOS_JOURNAL.json` (J_0001 ‚Üí J_0032)

### Components Delivered

| Component              | Script                              | Status                                                                      |
| ---------------------- | ----------------------------------- | --------------------------------------------------------------------------- |
| **Agent Core**         | `agent_compliance.py`               | ‚úÖ Pipeline 5 √©tapes ‚Äî RAG + Claude API                                     |
| **Document Detector**  | `detect_document_type.py`           | ‚úÖ Identification automatique type document                                 |
| **PDF Ingestion**      | `pdf_extractor.py`                  | ‚úÖ ETL PDF natif + OCR + XML Factur-X                                       |
| **RAG Vectoriel**      | `ingest_kos.py`                     | ‚úÖ ChromaDB + multilingual-e5-base                                          |
| **ERP Export**         | `export_erp.py`                     | ‚úÖ JSON ‚Üí CSV CEGID (3 gardes de s√©curit√©)                                  |
| **MR Reporter**        | `publish_report.py`                 | ‚úÖ Commentaire automatique GitLab MR                                        |
| **CI/CD Pipeline**     | `.gitlab-ci.yml`                    | ‚úÖ 4 stages op√©rationnels                                                   |
| **Constitutional KOS** | `Taxonomie.json` / `Agentique.json` | ‚úÖ v1.3.0 ‚Äî carte + r√®gles agentiques                                       |
| **Legal Corpus E1**    | 4 normes `.md`                      | ‚úÖ TVA, PCG, CGI Art.289, cadeaux                                           |
| **Test Cases**         | 5 factures/notes E3.1               | ‚úÖ A102 REJET, B001 CONFORME, C001 REJET, D001 CONFORME, E001 AVERTISSEMENT |

### Traceability & Governance

KOS_COMPTA int√®gre un syst√®me de tra√ßabilit√© complet, ind√©pendant de Git :

| Syst√®me            | Fichier               | R√¥le                                                                                                                                   |
| ------------------ | --------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| **Shadow Clone**   | `shadow_clone.py`     | Snapshots immuables du code √† chaque deploy ‚Äî permet de rejouer n'importe quelle version (15 fichiers surveill√©s, SHA-256 par fichier) |
| **KOS Journal**    | `KOS_JOURNAL.json`    | Journal constitutionnel horodat√© de toutes les d√©cisions et actions (J_0001 ‚Üí J_0032)                                                  |
| **ERGO Registry**  | `kos_registrar.py`    | Scan automatique des `ERGO_ID` dans chaque script ‚Äî registre des composants actifs                                                     |
| **Doc Versioning** | `doc_generator.py`    | Documentation `.md` auto-g√©n√©r√©e par composant, versionn√©e par SHA-256 (DOC_0001 ‚Üí DOC_0011)                                           |
| **Iteration Log**  | `ITERATIONS_LOG.json` | Dashboard Token Economy ‚Äî co√ªt LLM, tokens, dur√©e par analyse                                                                          |

### Remaining

| Livrable                             | Statut                          |
| ------------------------------------ | ------------------------------- |
| Vid√©o d√©mo 2-3 min                   | üî≤ √Ä enregistrer                |
| Devpost : URL repo + vid√©o + gallery | üî≤ √Ä finaliser avant le 25 mars |

---

## üöÄ Roadmap & Vision Produit

KOS_COMPTA a √©t√© pens√© d√®s le premier jour comme une architecture √©volutive (Ergodique). Le POC actuel d√©montre la viabilit√© du RAG Agentique, mais la roadmap technique pr√©voit d√©j√† les prochaines r√©volutions fiscales.

### 1. V2 - Veille L√©gale Curative (Self-Healing RAG)

Actuellement, le corpus de lois (Dossier `E1`) est statique. La V2 int√©grera une boucle de **Veille Curative** :

- Connexion via API √† **PISTE (L√©gifrance)**.
- D√©clenchement par GitLab CI/CD : si un article du Code G√©n√©ral des Imp√¥ts (CGI) est modifi√©, le syst√®me met √† jour automatiquement la base vectorielle (ChromaDB) de l'agent.
- L'IA n'est plus seulement experte, elle devient juridiquement intemporelle.

### 2. V3 - Anticipation R√©forme 2026 (Factur-X)

En septembre 2026, la facturation √©lectronique structur√©e deviendra obligatoire en France pour les entreprises.

- **Le probl√®me :** La fin du PDF simple (donn√©e non structur√©e).
- **La solution KOS :** Le script d'ingestion `pdf_extractor.py` sera mis √† jour pour lire nativement le flux **XML (Factur-X)** embarqu√© dans les nouvelles factures.
- **L'avantage :** L'Agent LLM n'aura plus besoin de faire de l'OCR incertain, il recevra une donn√©e d'entr√©e fiable √† 100 %, lui permettant de se concentrer uniquement sur l'audit fiscal et la d√©tection de fraudes.

---

## Workflow ‚Äî Relations entre Scripts

```mermaid
flowchart TD
    subgraph INPUT["üì• ENTR√âE"]
        PDF["PDF / XML / Factur-X"]
        MD["Facture .md manuelle"]
    end

    subgraph E0["üß† E0_MOTEUR_AGENTIQUE"]
        PDF_EX["pdf_extractor.py<br/><i>ETL : PDF ‚Üí .md structur√©</i>"]
        DETECT["detect_document_type.py<br/><i>D√©tection type document</i>"]
        INGEST["ingest_kos.py<br/><i>Vectorisation ChromaDB</i>"]
        AGENT["agent_compliance.py<br/><i>Audit LLM (Claude API)</i>"]
        EXPORT["export_erp.py<br/><i>JSON ‚Üí CSV CEGID</i>"]
        PUBLISH["publish_report.py<br/><i>Commentaire MR GitLab</i>"]
        SHADOW["shadow_clone.py<br/><i>Snapshots immuables</i>"]
        REGISTRAR["kos_registrar.py<br/><i>Registre ERGO_ID</i>"]
        DOCGEN["doc_generator.py<br/><i>Doc versionn√©e SHA-256</i>"]
    end

    subgraph KOS["üìö KNOWLEDGE BASE"]
        E1["E1_CORPUS_LEGAL<br/>CGI, PCG, ANC"]
        E2["E2_SOP_INTERNE<br/>Proc√©dures client"]
        CHROMA["KOS_DB<br/>ChromaDB vectoriel"]
    end

    subgraph E4["üì§ SORTIE"]
        E41["E4.1_Rapports<br/>REJET / AVERTISSEMENT"]
        E42["E4.2_Payloads<br/>PAYLOAD_*.json"]
        E43["E4.3_Imports_ERP<br/>IMPORT_CEGID_*.csv"]
        ARCHIVE["E4.2/archive<br/>JSONs trait√©s"]
    end

    PDF --> PDF_EX --> |".md + frontmatter"| DETECT
    MD --> DETECT
    DETECT --> AGENT

    E1 --> INGEST
    E2 --> INGEST
    INGEST --> CHROMA
    CHROMA -.-> |"RAG vectoriel"| AGENT

    AGENT --> |"REJET / AVERT."| E41
    AGENT --> |"CONFORME"| E42
    E41 --> PUBLISH
    E42 --> EXPORT
    EXPORT --> E43
    EXPORT --> |"Archivage transactionnel"| ARCHIVE

    SHADOW -.-> |"Snapshot code"| E0
    REGISTRAR -.-> |"Scan ERGO_ID"| E0
    DOCGEN -.-> |"SHA-256 versioning"| E0

    style AGENT fill:#f9a825,stroke:#f57f17,color:#000
    style EXPORT fill:#66bb6a,stroke:#388e3c,color:#000
    style E43 fill:#42a5f5,stroke:#1565c0,color:#fff
    style CHROMA fill:#ab47bc,stroke:#6a1b9a,color:#fff
```

---

## Legal Foundation

| Principe     | R√©f√©rence                     | Port√©e                                     |
| ------------ | ----------------------------- | ------------------------------------------ |
| R√©gularit√©   | Code de Commerce Art. L123-14 | Conformit√© aux r√®gles en vigueur           |
| Sinc√©rit√©    | Code de Commerce Art. L123-14 | Bonne foi, r√©alit√© √©conomique              |
| Image fid√®le | Code de Commerce Art. L123-14 | Patrimoine, situation financi√®re, r√©sultat |

> _Note : Article L123-14 constitue le socle minimal ‚Äî non exhaustif. Des prescriptions compl√©mentaires s'appliquent selon le secteur et la forme juridique._

---

## Author

**ERGO Capital ‚Äî Adam**  
BTS Comptabilit√© et Gestion ¬∑ Alternance Toulouse  
Bachelor Data & IA (en cours)  
Autodidacte MLOps ¬∑ KOS builder since GPT-3

---

_KOS_COMPTA : L'automatisation par la preuve._
